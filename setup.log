Updating package list and installing dependencies...
Hit:1 http://azure.archive.ubuntu.com/ubuntu jammy InRelease
Hit:2 http://azure.archive.ubuntu.com/ubuntu jammy-updates InRelease
Hit:3 http://azure.archive.ubuntu.com/ubuntu jammy-backports InRelease
Hit:4 http://azure.archive.ubuntu.com/ubuntu jammy-security InRelease
Hit:5 https://ngrok-agent.s3.amazonaws.com buster InRelease
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
nginx is already the newest version (1.18.0-6ubuntu14.4).
python3 is already the newest version (3.10.6-1~22.04).
rabbitmq-server is already the newest version (3.9.13-1ubuntu0.22.04.2).
python3-pip is already the newest version (22.0.2+dfsg-1ubuntu0.4).
0 upgraded, 0 newly installed, 0 to remove and 6 not upgraded.
Installing necessary Python packages...
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: Flask in /home/eben/.local/lib/python3.10/site-packages (3.0.3)
Requirement already satisfied: celery in /home/eben/.local/lib/python3.10/site-packages (5.4.0)
Requirement already satisfied: python-dotenv in /home/eben/.local/lib/python3.10/site-packages (1.0.1)
Requirement already satisfied: pytest in /home/eben/.local/lib/python3.10/site-packages (8.2.2)
Requirement already satisfied: Jinja2>=3.1.2 in /home/eben/.local/lib/python3.10/site-packages (from Flask) (3.1.4)
Requirement already satisfied: itsdangerous>=2.1.2 in /home/eben/.local/lib/python3.10/site-packages (from Flask) (2.2.0)
Requirement already satisfied: blinker>=1.6.2 in /home/eben/.local/lib/python3.10/site-packages (from Flask) (1.8.2)
Requirement already satisfied: Werkzeug>=3.0.0 in /home/eben/.local/lib/python3.10/site-packages (from Flask) (3.0.3)
Requirement already satisfied: click>=8.1.3 in /home/eben/.local/lib/python3.10/site-packages (from Flask) (8.1.7)
Requirement already satisfied: click-didyoumean>=0.3.0 in /home/eben/.local/lib/python3.10/site-packages (from celery) (0.3.1)
Requirement already satisfied: billiard<5.0,>=4.2.0 in /home/eben/.local/lib/python3.10/site-packages (from celery) (4.2.0)
Requirement already satisfied: click-plugins>=1.1.1 in /home/eben/.local/lib/python3.10/site-packages (from celery) (1.1.1)
Requirement already satisfied: click-repl>=0.2.0 in /home/eben/.local/lib/python3.10/site-packages (from celery) (0.3.0)
Requirement already satisfied: tzdata>=2022.7 in /home/eben/.local/lib/python3.10/site-packages (from celery) (2024.1)
Requirement already satisfied: vine<6.0,>=5.1.0 in /home/eben/.local/lib/python3.10/site-packages (from celery) (5.1.0)
Requirement already satisfied: python-dateutil>=2.8.2 in /home/eben/.local/lib/python3.10/site-packages (from celery) (2.9.0.post0)
Requirement already satisfied: kombu<6.0,>=5.3.4 in /home/eben/.local/lib/python3.10/site-packages (from celery) (5.3.7)
Requirement already satisfied: iniconfig in /home/eben/.local/lib/python3.10/site-packages (from pytest) (2.0.0)
Requirement already satisfied: pluggy<2.0,>=1.5 in /home/eben/.local/lib/python3.10/site-packages (from pytest) (1.5.0)
Requirement already satisfied: exceptiongroup>=1.0.0rc8 in /home/eben/.local/lib/python3.10/site-packages (from pytest) (1.2.1)
Requirement already satisfied: packaging in /home/eben/.local/lib/python3.10/site-packages (from pytest) (24.1)
Requirement already satisfied: tomli>=1 in /home/eben/.local/lib/python3.10/site-packages (from pytest) (2.0.1)
Requirement already satisfied: prompt-toolkit>=3.0.36 in /home/eben/.local/lib/python3.10/site-packages (from click-repl>=0.2.0->celery) (3.0.47)
Requirement already satisfied: MarkupSafe>=2.0 in /home/eben/.local/lib/python3.10/site-packages (from Jinja2>=3.1.2->Flask) (2.1.5)
Requirement already satisfied: amqp<6.0.0,>=5.1.1 in /home/eben/.local/lib/python3.10/site-packages (from kombu<6.0,>=5.3.4->celery) (5.2.0)
Requirement already satisfied: six>=1.5 in /usr/lib/python3/dist-packages (from python-dateutil>=2.8.2->celery) (1.16.0)
Requirement already satisfied: wcwidth in /home/eben/.local/lib/python3.10/site-packages (from prompt-toolkit>=3.0.36->click-repl>=0.2.0->celery) (0.2.13)
Creating project directory...
.env file already exists. Skipping creation.
requirements.txt already exists. Skipping creation.
celeryconfig.py already exists. Skipping creation.
celery_tasks.py already exists. Skipping creation.
Creating Nginx configuration file...
Symlinking Nginx configuration...
Restarting Nginx service...
Starting RabbitMQ server...
Stopping any existing Celery workers...
Starting Celery worker...
Starting Flask application...
Starting ngrok to expose port 5000...
Setup complete. You can now access the application.
Use the following commands to test the endpoints:
Send an email: curl http://localhost:5000/?sendmail=recipient@example.com
Log current time: curl http://localhost:5000/?talktome=1
Retrieve logs: curl http://localhost:5000/logs
 
 -------------- celery@eben v5.4.0 (opalescent)
--- ***** ----- 
-- ******* ---- Linux-6.5.0-1023-azure-x86_64-with-glibc2.35 2024-07-12 17:21:03
- *** --- * --- 
- ** ---------- [config]
- ** ---------- .> app:         tasks:0x75acd840e050
- ** ---------- .> transport:   amqp://guest:**@localhost:5672//
- ** ---------- .> results:     rpc://
- *** --- * --- .> concurrency: 2 (prefork)
-- ******* ---- .> task events: OFF (enable -E to monitor tasks in this worker)
--- ***** ----- 
 -------------- [queues]
                .> celery           exchange=celery(direct) key=celery
                

[tasks]
  . celery_tasks.send_email

[2024-07-12 17:21:03,187: WARNING/MainProcess] /home/eben/.local/lib/python3.10/site-packages/celery/worker/consumer/consumer.py:508: CPendingDeprecationWarning: The broker_connection_retry configuration setting will no longer determine
whether broker connection retries are made during startup in Celery 6.0 and above.
If you wish to retain the existing behavior for retrying connections on startup,
you should set broker_connection_retry_on_startup to True.
  warnings.warn(

[2024-07-12 17:21:03,194: INFO/MainProcess] Connected to amqp://guest:**@127.0.0.1:5672//
[2024-07-12 17:21:03,194: WARNING/MainProcess] /home/eben/.local/lib/python3.10/site-packages/celery/worker/consumer/consumer.py:508: CPendingDeprecationWarning: The broker_connection_retry configuration setting will no longer determine
whether broker connection retries are made during startup in Celery 6.0 and above.
If you wish to retain the existing behavior for retrying connections on startup,
you should set broker_connection_retry_on_startup to True.
  warnings.warn(

[2024-07-12 17:21:03,197: INFO/MainProcess] mingle: searching for neighbors
[2024-07-12 17:21:04,213: INFO/MainProcess] mingle: all alone
[2024-07-12 17:21:04,227: INFO/MainProcess] celery@eben ready.
[2024-07-12 17:43:56,412: INFO/MainProcess] Task celery_tasks.send_email[e38be485-f1a4-4fc2-bfde-32dec2cfb870] received
[2024-07-12 17:43:56,917: INFO/ForkPoolWorker-2] Task celery_tasks.send_email[e38be485-f1a4-4fc2-bfde-32dec2cfb870] succeeded in 0.503961624999647s: None

worker: Warm shutdown (MainProcess)
